<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PlotTwist — Sign in</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root {
      --bg: #0b0f14;
      --card: #0f1720;
      --card-2: #111927;
      --text: #e6edf3;
      --muted: #a7b0ba;
      --primary: #ff5a1f; /* brand-accent (custom orange) */
      --primary-2: #ffd166; /* brand-accent tint */
      --danger: #ef4444;
      --success: #22c55e;
      --ring: rgba(124, 58, 237, 0.45);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      color: var(--text);
      background: radial-gradient(1200px 800px at 80% -10%, rgba(124,58,237,.2), transparent),
                  radial-gradient(800px 600px at -10% 80%, rgba(23, 162, 184, .18), transparent),
                  linear-gradient(180deg, #0a0f14 0%, #0b0f14 40%, #06090d 100%);
      display: grid;
      place-items: center;
      padding: 2rem;
    }

    .container {
      width: 100%;
      max-width: 440px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: .75rem;
      margin-bottom: 1.25rem;
    }
    .brand .logo {
      width: 40px; height: 40px; border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--primary-2));
      display: grid; place-items: center;
      box-shadow: 0 8px 30px rgba(124,58,237,.35);
    }
    .brand h1 { font-size: 1.35rem; margin: 0; letter-spacing: .4px; }
    .brand p { margin: .2rem 0 0; color: var(--muted); font-size: .95rem; }

    .card {
      background: linear-gradient(180deg, var(--card), var(--card-2));
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,.45);
      padding: 1.25rem;
      backdrop-filter: saturate(140%) blur(10px);
    }

    form { display: grid; gap: .9rem; }

    label { font-weight: 600; font-size: .95rem; }

    .input {
      position: relative;
    }
    .input input {
      width: 100%;
      padding: .9rem 1rem;
      padding-right: 3rem;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(17,25,39,.6);
      color: var(--text);
      outline: none;
      box-shadow: 0 0 0 0 transparent;
      transition: box-shadow .15s ease, border-color .15s ease, background .15s ease;
    }
    .input input:focus {
      border-color: var(--primary-2);
      box-shadow: 0 0 0 6px var(--ring);
      background: rgba(17,25,39,.8);
    }

    .toggle-pw {
      position: absolute; right: .4rem; top: 50%; transform: translateY(-50%);
      border: 0; background: transparent; color: var(--muted);
      padding: .45rem .6rem; border-radius: 10px; cursor: pointer;
    }
    .toggle-pw:hover { color: var(--text); }

    .row { display: grid; gap: .4rem; }

    .options { display: flex; justify-content: space-between; align-items: center; }
    .options a { color: var(--primary-2); text-decoration: none; font-size: .9rem; }
    .options a:hover { text-decoration: underline; }

    .btn {
      display: inline-flex; align-items: center; justify-content: center; gap: .6rem;
      padding: .85rem 1rem; width: 100%;
      border-radius: 14px; border: 1px solid rgba(255,255,255,.08);
      background: linear-gradient(135deg, var(--primary), var(--primary-2));
      color: #0b0f14; font-weight: 700; letter-spacing: .2px;
      cursor: pointer;
      transition: transform .05s ease, filter .15s ease, opacity .15s ease;
    }
    .btn:active { transform: translateY(1px); }
    .btn[disabled] { opacity: .65; cursor: not-allowed; }

    .subtle {
      background: rgba(17,25,39,.7);
      color: var(--text);
    }

    .divider { display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: .75rem; color: var(--muted); font-size: .9rem; }
    .divider::before, .divider::after { content: ""; height: 1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,.1), transparent); }

    #msg { min-height: 1.25rem; font-size: .95rem; }
    #msg.error { color: var(--danger); }
    #msg.success { color: var(--success); }

    .helper { margin-top: .9rem; color: var(--muted); font-size: .95rem; text-align: center; }
    .helper a { color: var(--primary-2); text-decoration: none; }
    .helper a:hover { text-decoration: underline; }

    /* Reduce motion if user prefers */
    @media (prefers-reduced-motion: reduce) {
      .btn, input:focus { transition: none; }
    }
  </style>
</head>
<body>
  <main class="container" aria-labelledby="signin-title">
    <div class="brand" aria-hidden="true">
      <div class="logo" title="PlotTwist">
        <!-- simple film strip icon -->
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <rect x="3" y="4" width="18" height="16" rx="2" stroke="white" opacity=".9"/>
          <path d="M8 4v16M16 4v16" stroke="white" opacity=".9"/>
          <circle cx="6.5" cy="7" r=".9" fill="white"/>
          <circle cx="6.5" cy="12" r=".9" fill="white"/>
          <circle cx="6.5" cy="17" r=".9" fill="white"/>
          <circle cx="17.5" cy="7" r=".9" fill="white"/>
          <circle cx="17.5" cy="12" r=".9" fill="white"/>
          <circle cx="17.5" cy="17" r=".9" fill="white"/>
        </svg>
      </div>
      <div>
        <h1 id="signin-title">Log in to PlotTwist</h1>
        <p>Your watchlist, reviews, and recommendations—right where you left them.</p>
      </div>
    </div>

    <section class="card" role="region" aria-labelledby="form-title">
      <form id="loginForm" novalidate>
        <h2 id="form-title" class="sr-only" style="position:absolute;left:-9999px;">Sign in form</h2>

        <div class="row">
          <label for="username">Username or email</label>
          <div class="input">
            <input id="username" name="username" type="text" required autocomplete="username" placeholder="e.g. samvitale or sam@example.com" />
          </div>
        </div>

        <div class="row">
          <label for="password">Password</label>
          <div class="input">
            <input id="password" name="password" type="password" required minlength="8" autocomplete="current-password" placeholder="••••••••" />
            <button type="button" class="toggle-pw" id="togglePw" aria-pressed="false" aria-label="Show password">Show</button>
          </div>
        </div>

        <div class="options">
          <label style="display:flex; gap:.55rem; align-items:center; font-weight:500;">
            <input type="checkbox" id="remember" name="remember" />
            Keep me signed in on this device
          </label>
          <a href="#" id="forgot">Forgot password?</a>
        </div>

        <button id="submitBtn" class="btn" type="submit">
          <span class="btn-label">Sign in</span>
          <span class="spinner" aria-hidden="true" style="display:none; width:16px; height:16px; border-radius:50%; border:2px solid rgba(0,0,0,.25); border-top-color:#0b0f14; animation: spin .7s linear infinite"></span>
        </button>

        <div id="msg" role="alert" aria-live="polite"></div>

        

        <p class="helper">New here? <a href="register.html">Create an account</a></p>
      </form>
    </section>
  </main>

  <script>
    const form = document.getElementById('loginForm');
    const msg = document.getElementById('msg');
    const submitBtn = document.getElementById('submitBtn');
    const btnLabel = submitBtn.querySelector('.btn-label');
    const spinner = submitBtn.querySelector('.spinner');
    const togglePw = document.getElementById('togglePw');
    const pw = document.getElementById('password');

    function setLoading(isLoading) {
      submitBtn.disabled = isLoading;
      spinner.style.display = isLoading ? 'inline-block' : 'none';
      btnLabel.textContent = isLoading ? 'Signing in…' : 'Sign in';
    }

    togglePw.addEventListener('click', () => {
      const isText = pw.type === 'text';
      pw.type = isText ? 'password' : 'text';
      togglePw.textContent = isText ? 'Show' : 'Hide';
      togglePw.setAttribute('aria-pressed', String(!isText));
      pw.focus();
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      msg.textContent = '';
      msg.className = '';
      setLoading(true);

      const username = document.getElementById('username').value.trim();
      const password = pw.value;

      // Client-side checks (server still validates!)
      if (!username || !password || password.length < 8) {
        msg.textContent = 'Enter a valid username and a password (at least 8 chars).';
        msg.className = 'error';
        setLoading(false);
        return;
      }

      try {
        const res = await fetch('/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({
            username,
            password,
            remember: document.getElementById('remember').checked
          })
        });

        if (!res.ok) {
          const data = await res.json().catch(() => ({}));
          msg.textContent = data.error || 'Login failed. Check your credentials.';
          msg.className = 'error';
          setLoading(false);
          return;
        }

        const user = await res.json();
        msg.textContent = 'Signed in. Taking you to your dashboard…';
        msg.className = 'success';
        sessionStorage.setItem('displayName', user.displayName || user.username);

        // Keep this redirect to match your current app flow
        window.location.href = 'indexSeparatePages.html';
      } catch (err) {
        console.error(err);
        msg.textContent = 'Network error. Please try again.';
        msg.className = 'error';
        setLoading(false);
      }
    });

    // basic fake handler for Google button (wire up later)
    
    });

    // simple key UX: Enter on inputs triggers submit
    document.querySelectorAll('#username, #password').forEach(el => {
      el.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') form.requestSubmit();
      });
    });

    // Small UX improvement: preserve last username for convenience
    const lastUser = sessionStorage.getItem('lastUsername');
    if (lastUser) document.getElementById('username').value = lastUser;
    form.addEventListener('change', () => {
      const u = document.getElementById('username').value.trim();
      if (u) sessionStorage.setItem('lastUsername', u);
    });

    // CSS animation for spinner
    const style = document.createElement('style');
    style.textContent = `@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }`;
    document.head.appendChild(style);
  </script>
</body>
</html>
